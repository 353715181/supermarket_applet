"use strict";
function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", { value: true });
__export(require("./keyvalue"));
__export(require("./signer"));
__export(require("./utils.http"));
__export(require("./utils.lang"));
__export(require("./utils"));
const signer_1 = require("./signer");
const utils_1 = require("./utils");
const clone = require('clone');
function sign(options) {
    const { secretId, secretKey, method, url, service, withSignedParams, isCloudApi } = options;
    // isCloudApi 为 true, 说明使用 cloud api v3, 返回签名值中不能携带 signedParams
    let validWithSignedParams = withSignedParams;
    if (isCloudApi === true && withSignedParams === true) {
        console.warn('isCloudApi 和 withSignedParams 参数同时为 true, withSignedParams 会自动转为 false');
        validWithSignedParams = false;
    }
    const signer = new signer_1.Signer({ secretId, secretKey }, service || 'tcb');
    const headers = clone(options.headers || {});
    const params = clone(options.params || {});
    const timestamp = options.timestamp || utils_1.second() - 1;
    const signatureInfo = signer.tc3sign(method, url, headers, params, timestamp, {
        withSignedParams: validWithSignedParams,
        isCloudApi
    });
    return {
        authorization: signatureInfo.authorization,
        timestamp: signatureInfo.timestamp,
        multipart: signatureInfo.multipart
    };
}
exports.sign = sign;
